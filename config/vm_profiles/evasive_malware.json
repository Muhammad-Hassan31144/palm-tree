{
  "profile_name": "evasive_malware",
  "profile_version": "1.0.0",
  "description": "Specialized VM configuration for analyzing evasive and advanced malware samples",
  "created": "2025-01-01",
  "last_updated": "2025-01-01",
  "parent_profile": "default",

  "vm_configuration": {
    "hardware": {
      "cpu_cores": 4,
      "memory_mb": 8192,
      "disk_size_gb": 80,
      "network_adapters": 2,
      "architecture": "x64",
      "enable_nested_virtualization": false,
      "cpu_topology": {
        "sockets": 1,
        "cores": 4,
        "threads": 1
      }
    },
    "guest_os": {
      "type": "windows",
      "version": "Windows 10",
      "edition": "Professional",
      "build": "19045",
      "language": "en-US",
      "timezone": "Eastern Standard Time",
      "install_patches": "2023-06-15"
    },
    "credentials": {
      "username": "Administrator",
      "password": "P@ssw0rd123!",
      "auto_login": true,
      "enable_rdp": false
    }
  },

  "stealth_configuration": {
    "anti_detection": {
      "hide_hypervisor_flag": true,
      "custom_cpu_model": "Haswell-noTSX",
      "cpu_features": ["-vmx", "-hypervisor", "-svm", "+pcid", "+invpcid"],
      "randomize_mac": true,
      "use_localtime_rtc": true,
      "disable_hpet": true,
      "machine_type": "q35",
      "hide_qemu_devices": true,
      "custom_pci_devices": true
    },
    "smbios_spoofing": {
      "enable_spoofing": true,
      "system_manufacturer": "LENOVO",
      "system_product_name": "ThinkPad X1 Carbon Gen 9",
      "system_version": "ThinkPad X1 Carbon Gen 9",
      "system_serial_number": "PF2QRSTU",
      "system_uuid": "12345678-1234-5678-9ABC-DEF012345678",
      "bios_vendor": "LENOVO",
      "bios_version": "N32ET86W (1.64 )",
      "bios_release_date": "08/17/2023",
      "board_manufacturer": "LENOVO",
      "board_product_name": "20XWCTO1WW",
      "board_version": "SDK0J40697 WIN",
      "chassis_manufacturer": "LENOVO",
      "chassis_type": "10",
      "chassis_serial_number": "PF2QRSTU"
    },
    "environment_simulation": {
      "simulate_user_activity": true,
      "install_common_software": true,
      "populate_user_directories": true,
      "create_browsing_history": true,
      "simulate_office_usage": true
    }
  },

  "monitoring_configuration": {
    "procmon": {
      "enabled": true,
      "config_file": "config/procmon/procmon_config.pmc",
      "behavioral_filters": "config/procmon/behavioral_filters.json",
      "noise_filters": "config/procmon/noise_filters.json",
      "malware_patterns": "config/procmon/malware_patterns.json",
      "auto_start": true,
      "duration_seconds": 1200,
      "filter_level": "conservative",
      "export_format": "csv",
      "log_directory": "C:\\Analysis\\Logs",
      "max_log_size_mb": 1000,
      "enable_stack_trace": false,
      "enable_process_tree": true
    },
    "network_capture": {
      "enabled": true,
      "interface": "auto",
      "capture_filter": "not (host 192.168.100.1 or arp or icmp6)",
      "duration_seconds": 1200,
      "max_capture_size_mb": 250,
      "output_directory": "logs/network",
      "enable_ssl_decryption": false,
      "capture_dns": true,
      "capture_http": true
    },
    "memory_analysis": {
      "enabled": true,
      "auto_dump": false,
      "dump_on_suspicious_activity": true,
      "dump_interval_seconds": 600,
      "volatility_profile": "Win10x64_19041",
      "dump_format": "raw"
    },
    "additional_monitoring": {
      "api_monitor": {
        "enabled": true,
        "monitor_crypto_apis": true,
        "monitor_network_apis": true,
        "monitor_file_apis": true,
        "monitor_registry_apis": true,
        "monitor_process_apis": true
      },
      "registry_monitor": {
        "enabled": true,
        "real_time": true,
        "backup_before_changes": true
      }
    }
  },

  "analysis_configuration": {
    "behavioral_analysis": {
      "enabled": true,
      "processor": "shikra.core.modules.monitoring.procmon_processor",
      "config_overrides": {
        "behavioral_thresholds": {
          "mass_file_modification": {"threshold": 25, "time_window_seconds": 180},
          "registry_modifications": {"threshold": 10, "time_window_seconds": 120},
          "process_creation_burst": {"threshold": 5, "time_window_seconds": 30},
          "network_connections": {"threshold": 10, "time_window_seconds": 60}
        },
        "detection_sensitivity": "high",
        "evasion_detection": {
          "sleep_analysis": true,
          "timing_analysis": true,
          "api_hashing_detection": true,
          "packing_detection": true
        }
      }
    },
    "network_analysis": {
      "enabled": true,
      "processor": "shikra.analysis.modules.analysis.network_analysis",
      "pcap_parser_preference": "pyshark",
      "dns_analysis": true,
      "http_analysis": true,
      "tls_analysis": true,
      "deep_packet_inspection": true,
      "c2_detection": {
        "enabled": true,
        "beacon_detection": true,
        "domain_generation_detection": true,
        "tor_detection": true
      }
    },
    "static_analysis": {
      "enabled": true,
      "yara_rules_directory": "rules/yara",
      "pe_analysis": true,
      "strings_analysis": true,
      "entropy_analysis": true,
      "packer_detection": true,
      "crypto_detection": true
    },
    "memory_analysis": {
      "enabled": true,
      "processor": "shikra.analysis.modules.analysis.memory_analysis",
      "volatility_plugins": [
        "windows.pslist.PsList",
        "windows.psscan.PsScan", 
        "windows.malfind.Malfind",
        "windows.hollowfind.HollowFind",
        "windows.netscan.NetScan",
        "windows.cmdline.CmdLine"
      ]
    }
  },

  "network_configuration": {
    "isolation": {
      "internet_access": false,
      "inetsim_enabled": true,
      "fake_services": {
        "dns": true,
        "http": true,
        "https": true,
        "smtp": true,
        "pop3": true,
        "irc": true,
        "ftp": true,
        "ntp": true,
        "tftp": true
      },
      "tor_simulation": true,
      "c2_simulation": true
    },
    "subnet": "192.168.100.0/24",
    "vm_ip": "192.168.100.20",
    "gateway_ip": "192.168.100.1",
    "dns_servers": ["192.168.100.1"],
    "additional_interfaces": [
      {
        "name": "isolated",
        "subnet": "10.0.1.0/24",
        "ip": "10.0.1.10"
      }
    ]
  },

  "security_configuration": {
    "windows_security": {
      "disable_defender": true,
      "disable_firewall": true,
      "disable_uac": true,
      "disable_updates": true,
      "disable_error_reporting": true,
      "disable_system_restore": true,
      "disable_applocker": true,
      "disable_device_guard": true,
      "disable_smart_screen": true,
      "disable_amsi": true
    },
    "analysis_safety": {
      "snapshot_before_analysis": true,
      "snapshot_during_analysis": true,
      "revert_after_analysis": true,
      "isolate_network": true,
      "monitor_host_resources": true,
      "enable_host_isolation": true
    },
    "evasion_countermeasures": {
      "hide_analysis_tools": true,
      "randomize_system_info": true,
      "simulate_user_interaction": true,
      "delay_analysis_start": 300,
      "enable_anti_evasion": true
    }
  },

  "automation_configuration": {
    "pre_analysis_scripts": [
      {
        "name": "setup_environment",
        "script": "core/scripts/setup_procmon.ps1",
        "type": "powershell",
        "timeout": 300,
        "required": true
      },
      {
        "name": "disable_security_complete",
        "script": "Set-MpPreference -DisableRealtimeMonitoring $true; Set-MpPreference -DisableBehaviorMonitoring $true; Set-MpPreference -DisableIOAVProtection $true; netsh advfirewall set allprofiles state off; reg add 'HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System' /v EnableLUA /t REG_DWORD /d 0 /f",
        "type": "powershell_inline",
        "timeout": 120,
        "required": true
      },
      {
        "name": "populate_environment",
        "script": "New-Item -ItemType Directory -Path 'C:\\Users\\Administrator\\Documents\\Work' -Force; New-Item -ItemType File -Path 'C:\\Users\\Administrator\\Documents\\Work\\project.docx' -Force; New-Item -ItemType File -Path 'C:\\Users\\Administrator\\Desktop\\notes.txt' -Force",
        "type": "powershell_inline",
        "timeout": 60,
        "required": false
      },
      {
        "name": "simulate_user_activity",
        "script": "Start-Process notepad.exe -PassThru | Stop-Process -Force; Start-Sleep 5; Get-Process | Where-Object {$_.ProcessName -eq 'explorer'} | ForEach-Object {$_.Refresh()}",
        "type": "powershell_inline",
        "timeout": 30,
        "required": false
      }
    ],
    "post_analysis_scripts": [
      {
        "name": "collect_comprehensive_logs",
        "script": "Get-ChildItem C:\\Analysis\\Logs\\* -Recurse | Copy-Item -Destination C:\\Windows\\Temp\\ -Force; Get-EventLog -LogName System -Newest 100 | Export-Csv C:\\Windows\\Temp\\system_events.csv -NoTypeInformation; Get-EventLog -LogName Application -Newest 100 | Export-Csv C:\\Windows\\Temp\\app_events.csv -NoTypeInformation",
        "type": "powershell_inline",
        "timeout": 180,
        "required": true
      },
      {
        "name": "memory_dump",
        "script": "if (Get-Process | Where-Object {$_.ProcessName -match 'malware|suspicious'}) { Write-Host 'Suspicious process detected, creating memory dump'; }",
        "type": "powershell_inline",
        "timeout": 300,
        "required": false
      },
      {
        "name": "cleanup_evidence",
        "script": "Remove-Item C:\\Windows\\Temp\\procmon* -Force -ErrorAction SilentlyContinue; Remove-Item C:\\Analysis\\Tools\\* -Force -Recurse -ErrorAction SilentlyContinue",
        "type": "powershell_inline",
        "timeout": 120,
        "required": false
      }
    ],
    "execution_delays": {
      "pre_execution_delay": 300,
      "post_execution_delay": 600,
      "randomize_delays": true,
      "delay_variance_percent": 20
    }
  },

  "sample_handling": {
    "upload_directory": "C:\\Samples",
    "execution_timeout": 600,
    "auto_execute": false,
    "execution_parameters": ["/S", "/Q", "/SILENT"],
    "file_extensions_to_execute": [".exe", ".com", ".scr", ".bat", ".cmd", ".msi", ".dll", ".ps1"],
    "analysis_duration": 1200,
    "multi_stage_execution": {
      "enabled": true,
      "stages": [
        {"delay": 0, "action": "execute"},
        {"delay": 300, "action": "interact"},
        {"delay": 600, "action": "network_stimulate"},
        {"delay": 900, "action": "memory_pressure"}
      ]
    }
  },

  "reporting_configuration": {
    "formats": ["json", "html", "text"],
    "include_screenshots": true,
    "include_network_pcap": true,
    "include_memory_dump": true,
    "include_procmon_logs": true,
    "include_event_logs": true,
    "compress_results": true,
    "detailed_timeline": true,
    "ioc_extraction": true,
    "mitre_mapping": true
  },

  "integration_points": {
    "behavioral_processor": {
      "module": "shikra.core.modules.monitoring.procmon_processor",
      "config_files": [
        "config/procmon/behavioral_filters.json",
        "config/procmon/noise_filters.json",
        "config/procmon/malware_patterns.json"
      ],
      "config_overrides": {
        "filter_level": "conservative",
        "detection_sensitivity": "high"
      }
    },
    "vm_controller": {
      "copy_to_vm": "shikra.core.modules.vm_controller.copy_to_vm",
      "copy_from_vm": "shikra.core.modules.vm_controller.copy_from_vm", 
      "run_in_vm": "shikra.core.modules.vm_controller.run_in_vm",
      "stealth": "shikra.core.modules.vm_controller.stealth",
      "snapshot": "shikra.core.modules.vm_controller.snapshot"
    },
    "analysis_pipeline": {
      "behavioral": "shikra.analysis.modules.analysis.behavioral",
      "network": "shikra.analysis.modules.analysis.network_analysis",
      "memory": "shikra.analysis.modules.analysis.memory_analysis",
      "static": "shikra.analysis.modules.analysis.static_analysis"
    },
    "reporting": {
      "generator": "shikra.reporting.modules.reporting.report_generator",
      "visualizer": "shikra.reporting.modules.reporting.visualizer",
      "timeline": "shikra.reporting.modules.reporting.timeline_analyzer"
    }
  },

  "thresholds_and_limits": {
    "analysis": {
      "max_analysis_time_seconds": 3600,
      "max_procmon_events": 2000000,
      "max_network_packets": 1000000,
      "max_log_file_size_mb": 1000,
      "memory_dump_trigger_threshold": 60
    },
    "resources": {
      "max_cpu_usage_percent": 90,
      "max_memory_usage_percent": 85,
      "max_disk_usage_percent": 90
    },
    "detection": {
      "malware_score_threshold": 60,
      "suspicious_activity_threshold": 30,
      "evasion_detection_threshold": 70,
      "noise_filter_aggressiveness": 70
    }
  },

  "advanced_features": {
    "machine_learning": {
      "enabled": false,
      "model_path": "models/evasion_detection.pkl",
      "confidence_threshold": 0.8
    },
    "sandbox_detection_evasion": {
      "enabled": true,
      "techniques": [
        "timing_delays",
        "user_interaction_simulation", 
        "environment_checks",
        "process_hollowing_detection",
        "api_hooking_detection"
      ]
    },
    "adaptive_analysis": {
      "enabled": true,
      "extend_analysis_on_activity": true,
      "activity_threshold": 50,
      "max_extension_seconds": 1800
    }
  },

  "error_handling": {
    "retry_attempts": 5,
    "retry_delay_seconds": 10,
    "continue_on_non_critical_errors": true,
    "log_all_errors": true,
    "revert_vm_on_critical_error": true,
    "escalate_on_repeated_failures": true
  },

  "compatibility": {
    "qemu_version": "6.0+",
    "libvirt_version": "7.0+",
    "supported_host_os": ["linux"],
    "required_tools": ["procmon.exe", "tshark", "volatility3", "yara"],
    "minimum_host_memory_gb": 16,
    "minimum_host_disk_gb": 200,
    "recommended_host_cpu_cores": 8
  }
}