{
  "pattern_version": "1.0.0",
  "description": "Advanced malware detection patterns for Shikra behavioral analysis",
  "last_updated": "2025-01-01",

  "file_extensions": {
    "ransomware_extensions": [
      ".encrypted", ".locked", ".crypted", ".crypt", ".cry", ".crypto", 
      ".enc", ".encrypt", ".kraken", ".zzz", ".wncry", ".wcry", ".wncrypt",
      ".micro", ".thor", ".zepto", ".locky", ".cerber", ".osiris", ".petya",
      ".vault", ".onion", ".legion", ".rip", ".sage", ".enciphered", ".aaa",
      ".abc", ".ccc", ".ecc", ".ezz", ".exx", ".xyz", ".hb15", ".bip",
      ".gws", ".maktub", ".fantom", ".bart", ".lock", ".corona", ".email",
      ".darkness", ".dharma", ".phobos", ".makop", ".sodinokibi", ".revil"
    ],
    "executable_extensions": [
      ".exe", ".com", ".scr", ".bat", ".cmd", ".pif", ".msi", ".dll"
    ],
    "script_extensions": [
      ".ps1", ".vbs", ".js", ".jar", ".py", ".pl", ".rb", ".php"
    ],
    "document_extensions": [
      ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx", ".pdf", ".rtf"
    ],
    "targeted_extensions": [
      ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx", ".pst", ".ost",
      ".msg", ".eml", ".vsd", ".vsdx", ".txt", ".csv", ".rtf", ".123",
      ".wks", ".wk1", ".pdf", ".dwg", ".onetoc2", ".snt", ".jpeg", ".jpg",
      ".docb", ".docm", ".dot", ".dotm", ".dotx", ".xlsm", ".xlsb", ".xlw",
      ".xlt", ".xlm", ".xlc", ".xltx", ".xltm", ".pptm", ".pot", ".pps",
      ".ppsm", ".ppsx", ".ppam", ".potx", ".potm", ".edb", ".hwp", ".602",
      ".sxi", ".sti", ".sldx", ".sldm", ".vdi", ".vmdk", ".vmx", ".gpg",
      ".aes", ".ARC", ".PAQ", ".bz2", ".tbk", ".bak", ".tar", ".tgz",
      ".gz", ".7z", ".rar", ".zip", ".backup", ".iso", ".vcd", ".bmp",
      ".png", ".gif", ".raw", ".cgm", ".tif", ".tiff", ".nef", ".psd",
      ".ai", ".svg", ".djvu", ".m4u", ".m3u", ".mid", ".wma", ".flv",
      ".3g2", ".mkv", ".3gp", ".mp4", ".mov", ".avi", ".asf", ".mpeg",
      ".vob", ".mpg", ".wmv", ".fla", ".swf", ".wav", ".mp3"
    ]
  },

  "suspicious_processes": {
    "ransomware_process_names": [
      "cryptolocker", "cerber", "locky", "petya", "wannacry", "wcry",
      "badrabbit", "notpetya", "gandcrab", "ryuk", "maze", "conti",
      "lockbit", "darkside", "revil", "sodinokibi", "dharma", "phobos",
      "makop", "nemty", "snakehose", "mailto", "corona", "avaddon"
    ],
    "suspicious_name_patterns": [
      "^[a-f0-9]{8,32}\\.(exe|com|scr)$",
      "^(temp|tmp|new|copy|update|install|setup)[0-9]*\\.(exe|bat|cmd)$",
      "^[0-9]+\\.(exe|com|scr)$",
      "^.{1,3}\\.(exe|com|scr)$",
      "^(svchost|explorer|system|winlogon|csrss)[0-9]*\\.(exe|com)$"
    ],
    "process_impersonation": [
      "svchost.exe", "explorer.exe", "system.exe", "winlogon.exe",
      "csrss.exe", "lsass.exe", "services.exe", "dwm.exe"
    ]
  },

  "command_line_patterns": {
    "shadow_copy_deletion": [
      "vssadmin.*delete.*shadows.*\\/all",
      "vssadmin.*delete.*shadows.*\\/quiet",
      "wbadmin.*delete.*catalog.*\\/quiet",
      "wmic.*shadowcopy.*delete",
      "wmic.*shadowstorage.*delete",
      "bcdedit.*\\/set.*bootstatuspolicy.*ignoreallfailures",
      "bcdedit.*\\/set.*recoveryenabled.*no"
    ],
    "service_manipulation": [
      "net\\s+stop\\s+(vss|swprv|sqlvss|mssql|mysql|memtas|mepocs)",
      "net\\s+stop\\s+(sophos|symantec|mcafee|kaspersky|trend)",
      "sc\\s+stop\\s+(vss|swprv|sqlvss|mssql|mysql)",
      "sc\\s+delete\\s+(vss|swprv|sqlvss)"
    ],
    "process_termination": [
      "taskkill.*\\/f.*\\/im.*(sql|mysql|oracle|postgres)",
      "taskkill.*\\/f.*\\/im.*(outlook|thunderbird|firefox|chrome)",
      "taskkill.*\\/f.*\\/im.*(excel|word|powerpoint|winword)",
      "taskkill.*\\/f.*\\/im.*(sophos|symantec|mcafee|kaspersky)"
    ],
    "powershell_obfuscation": [
      "powershell.*-enc.*[A-Za-z0-9+/=]{50,}",
      "powershell.*-encoded.*[A-Za-z0-9+/=]{50,}",
      "powershell.*-e\\s+[A-Za-z0-9+/=]{50,}",
      "powershell.*-hidden.*-exec.*bypass",
      "powershell.*invoke-expression.*\\$",
      "powershell.*iex.*\\(",
      "powershell.*frombase64string"
    ],
    "registry_manipulation": [
      "reg\\s+add.*run.*\\/v.*\\/d",
      "reg\\s+delete.*run.*\\/f",
      "reg\\s+add.*policies.*system.*\\/v.*enablelua.*\\/d.*0",
      "reg\\s+add.*windows.*currentversion.*policies.*system"
    ],
    "scheduled_tasks": [
      "schtasks.*\\/create.*\\/tn.*\\/tr.*\\/sc",
      "schtasks.*\\/run.*\\/tn",
      "at\\s+[0-9:]+\\s+.*\\.(exe|bat|cmd)"
    ],
    "file_attribute_changes": [
      "attrib.*\\+h.*\\+s.*\\+r",
      "attrib.*\\+h.*\\.",
      "icacls.*\\/grant.*everyone.*f",
      "icacls.*\\/inheritance:r"
    ]
  },

  "file_operation_patterns": {
    "suspicious_file_locations": [
      "\\\\temp\\\\[a-f0-9]{8,}\\.(exe|dll|bat|cmd|scr)",
      "\\\\appdata\\\\local\\\\temp\\\\.*\\.(exe|dll|scr)",
      "\\\\programdata\\\\[a-f0-9]{8,}\\.(exe|dll)",
      "\\\\users\\\\public\\\\.*\\.(exe|dll|bat|cmd)",
      "\\\\windows\\\\temp\\\\.*\\.(exe|dll|scr)",
      "c:\\\\[a-f0-9]{8,}\\.(exe|dll|txt|log)"
    ],
    "ransom_note_patterns": [
      "readme.*\\.(txt|html|hta)",
      "decrypt.*\\.(txt|html|hta)",
      "how.*to.*decrypt.*\\.(txt|html|hta)",
      "recovery.*\\.(txt|html|hta)",
      "restore.*files.*\\.(txt|html|hta)",
      "your.*files.*\\.(txt|html|hta)",
      "!!!.*\\.(txt|html|hta)",
      "\\@\\@\\@.*\\.(txt|html|hta)",
      "read.*this.*\\.(txt|html|hta)"
    ],
    "mass_file_operations": {
      "file_count_threshold": 50,
      "time_window_seconds": 300,
      "target_directories": [
        "\\\\documents\\\\",
        "\\\\desktop\\\\",
        "\\\\pictures\\\\",
        "\\\\downloads\\\\",
        "\\\\videos\\\\",
        "\\\\music\\\\",
        "\\\\onedrive\\\\",
        "\\\\dropbox\\\\",
        "\\\\googledrive\\\\"
      ]
    }
  },

  "registry_patterns": {
    "persistence_keys": [
      "HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run",
      "HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run",
      "HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce",
      "HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce",
      "HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\",
      "HKLM\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\",
      "HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\Run",
      "HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\Run",
      "HKLM\\\\Software\\\\Microsoft\\\\Active Setup\\\\Installed Components\\\\",
      "HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Shell Folders",
      "HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User Shell Folders"
    ],
    "security_tampering": [
      "HKLM\\\\Software\\\\Microsoft\\\\Security Center\\\\",
      "HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\",
      "HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\EnableLUA",
      "HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\ConsentPromptBehaviorAdmin",
      "HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\SafeBoot\\\\",
      "HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\SharedAccess\\\\Parameters\\\\FirewallPolicy\\\\"
    ],
    "ransomware_specific": [
      "HKCU\\\\Software\\\\.*\\\\ecdh_pub_k",
      "HKCU\\\\Software\\\\.*\\\\ecdh_crypt_k", 
      "HKLM\\\\Software\\\\.*\\\\public_key_*",
      "HKCU\\\\Software\\\\.*\\\\PersonalID",
      "HKCU\\\\Software\\\\.*\\\\rnd_ext"
    ]
  },

  "network_patterns": {
    "suspicious_domains": [
      ".*\\.onion",
      ".*\\.bit",
      ".*\\.bazar",
      "pastebin\\.com",
      "paste\\.ee",
      "ghostbin\\.co",
      "mega\\.(nz|io|co\\.nz)",
      "anonfile\\.com",
      "sendspace\\.com",
      "transfer\\.sh",
      "temp\\.sh",
      "file\\.io",
      "ufile\\.io"
    ],
    "c2_indicators": [
      "checkip\\.dyndns\\.org",
      "icanhazip\\.com",
      "ipinfo\\.io",
      "httpbin\\.org\\/ip",
      "api\\.ipify\\.org",
      ".*\\.no-ip\\.(com|org|net)",
      ".*\\.ddns\\.net",
      ".*\\.duckdns\\.org",
      ".*\\.hopto\\.org"
    ],
    "crypto_payment_sites": [
      "blockchain\\.info",
      "btc\\.com",
      "coinbase\\.com",
      "binance\\.com",
      "localbitcoins\\.com",
      "paxful\\.com"
    ]
  },

  "behavioral_indicators": {
    "encryption_behavior": {
      "api_calls": [
        "CryptAcquireContext",
        "CryptGenKey",
        "CryptEncrypt",
        "CryptDecrypt",
        "CryptCreateHash",
        "CryptHashData",
        "CryptDeriveKey",
        "BCryptEncrypt",
        "BCryptDecrypt",
        "BCryptGenRandom",
        "BCryptGenerateSymmetricKey",
        "CryptGenRandom"
      ],
      "file_patterns": [
        "Mass modification of targeted file types",
        "Creation of files with ransomware extensions",
        "Deletion of original files after encryption",
        "Creation of ransom note files"
      ]
    },
    "evasion_techniques": {
      "anti_debugging": [
        "IsDebuggerPresent",
        "CheckRemoteDebuggerPresent",
        "GetTickCount",
        "QueryPerformanceCounter",
        "timeGetTime"
      ],
      "anti_vm": [
        "VBOX",
        "VMWARE",
        "VirtualBox",
        "VMware",
        "VBoxService",
        "vmtoolsd",
        "vmmouse",
        "vmhgfs"
      ],
      "process_hollowing": [
        "VirtualAlloc",
        "VirtualAllocEx", 
        "VirtualProtect",
        "VirtualProtectEx",
        "WriteProcessMemory",
        "ReadProcessMemory",
        "CreateRemoteThread",
        "NtUnmapViewOfSection",
        "ZwUnmapViewOfSection"
      ],
      "sleep_evasion": [
        "Sleep",
        "SleepEx", 
        "WaitForSingleObject",
        "WaitForMultipleObjects",
        "SetTimer"
      ]
    },
    "privilege_escalation": {
      "uac_bypass": [
        "eventvwr\\.exe",
        "fodhelper\\.exe",
        "computerdefaults\\.exe",
        "sdclt\\.exe",
        "slui\\.exe"
      ],
      "token_manipulation": [
        "OpenProcessToken",
        "AdjustTokenPrivileges",
        "LookupPrivilegeValue",
        "ImpersonateLoggedOnUser"
      ]
    },
    "data_exfiltration": {
      "clipboard_access": [
        "GetClipboardData",
        "SetClipboardData",
        "OpenClipboard",
        "EmptyClipboard",
        "CloseClipboard"
      ],
      "screen_capture": [
        "BitBlt",
        "GetDC",
        "CreateDIBSection",
        "GetDIBits"
      ],
      "keylogging": [
        "SetWindowsHookEx",
        "GetAsyncKeyState",
        "GetKeyState",
        "MapVirtualKey"
      ]
    }
  },

  "detection_thresholds": {
    "file_operations": {
      "mass_modification_threshold": 50,
      "time_window_seconds": 300,
      "extension_diversity_threshold": 5
    },
    "process_operations": {
      "rapid_creation_threshold": 10,
      "time_window_seconds": 60,
      "suspicious_name_threshold": 3
    },
    "registry_operations": {
      "rapid_modification_threshold": 20,
      "time_window_seconds": 180,
      "persistence_key_threshold": 3
    },
    "network_operations": {
      "connection_burst_threshold": 15,
      "time_window_seconds": 120,
      "unique_destination_threshold": 10
    }
  },

  "scoring_weights": {
    "file_operations": {
      "ransomware_extension": 30,
      "mass_modification": 25,
      "ransom_note_creation": 20,
      "suspicious_location": 15,
      "target_extension": 10
    },
    "process_operations": {
      "ransomware_name": 35,
      "suspicious_cmdline": 25,
      "impersonation": 20,
      "rapid_creation": 15,
      "suspicious_location": 10
    },
    "registry_operations": {
      "persistence_mechanism": 25,
      "security_tampering": 30,
      "ransomware_specific": 35,
      "rapid_modification": 15
    },
    "network_operations": {
      "c2_communication": 35,
      "suspicious_domain": 25,
      "tor_usage": 30,
      "crypto_site": 20,
      "connection_burst": 15
    },
    "behavioral_indicators": {
      "encryption_behavior": 40,
      "evasion_techniques": 30,
      "privilege_escalation": 25,
      "data_exfiltration": 20
    }
  },

  "family_signatures": {
    "wannacry": {
      "file_patterns": [
        ".*\\.wncry$",
        ".*\\.wcry$", 
        ".*\\.wncrypt$"
      ],
      "ransom_notes": [
        "@WanaDecryptor@\\.exe",
        "@Please_Read_Me@\\.txt"
      ],
      "mutex_names": [
        "MsWinZonesCacheCounterMutex",
        "Global\\MsWinZonesCacheCounterMutex"
      ]
    },
    "ryuk": {
      "file_patterns": [
        ".*\\.ryk$",
        ".*\\.ryuk$"
      ],
      "ransom_notes": [
        "RyukReadMe\\.txt",
        "RyukReadMe\\.html"
      ],
      "process_names": [
        "ryuk\\.exe",
        "*.ryuk"
      ]
    },
    "lockbit": {
      "file_patterns": [
        ".*\\.lockbit$",
        ".*\\.abcd$"
      ],
      "ransom_notes": [
        "Restore-My-Files\\.txt",
        "LockBit_Ransomware\\.txt"
      ],
      "wallpaper_changes": [
        "LockBit.*wallpaper"
      ]
    },
    "conti": {
      "file_patterns": [
        ".*\\.conti$"
      ],
      "ransom_notes": [
        "readme\\.txt",
        "CONTI_README\\.txt"
      ],
      "mutex_names": [
        "kjklo9s8743lkjhg"
      ]
    }
  },

  "whitelist_patterns": {
    "legitimate_processes": [
      "svchost\\.exe.*-k.*",
      "explorer\\.exe$",
      "dwm\\.exe$",
      "winlogon\\.exe$",
      "csrss\\.exe$",
      "lsass\\.exe$",
      "services\\.exe$",
      "smss\\.exe$",
      "wininit\\.exe$"
    ],
    "system_file_locations": [
      "C:\\\\Windows\\\\System32\\\\",
      "C:\\\\Windows\\\\SysWOW64\\\\",
      "C:\\\\Program Files\\\\",
      "C:\\\\Program Files \\(x86\\)\\\\"
    ],
    "legitimate_registry_keys": [
      "HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\.*",
      "HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\",
      "HKLM\\\\SOFTWARE\\\\Classes\\\\CLSID\\\\"
    ]
  },

  "analysis_rules": {
    "correlation_rules": [
      {
        "name": "File Encryption Activity",
        "conditions": [
          "mass_file_modification AND ransom_note_creation",
          "mass_file_modification AND ransomware_extension_creation",
          "shadow_copy_deletion AND mass_file_modification"
        ],
        "severity": "critical",
        "score": 90
      },
      {
        "name": "Persistence Establishment", 
        "conditions": [
          "registry_run_key_creation AND suspicious_process_creation",
          "service_creation AND executable_in_temp",
          "scheduled_task_creation AND suspicious_executable"
        ],
        "severity": "high",
        "score": 70
      },
      {
        "name": "Anti-Analysis Behavior",
        "conditions": [
          "debugger_detection AND vm_detection",
          "multiple_sleep_calls AND api_hashing",
          "process_hollowing AND anti_vm_checks"
        ],
        "severity": "high", 
        "score": 75
      },
      {
        "name": "Data Theft Preparation",
        "conditions": [
          "clipboard_monitoring AND screen_capture",
          "keylogging AND network_communication",
          "file_enumeration AND network_exfiltration"
        ],
        "severity": "high",
        "score": 80
      }
    ],
    "exclusion_rules": [
      {
        "name": "System Process Legitimate Activity",
        "conditions": [
          "process_name IN legitimate_processes",
          "file_location IN system_file_locations",
          "registry_key IN legitimate_registry_keys"
        ],
        "action": "exclude"
      },
      {
        "name": "Installer Activity",
        "conditions": [
          "process_name MATCHES msiexec\\.exe",
          "temp_file_creation AND msi_package_present"
        ],
        "action": "reduce_score",
        "score_multiplier": 0.3
      }
    ]
  }
}